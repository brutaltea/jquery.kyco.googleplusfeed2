/*
**
**  jquery.kyco.googleplusfeed
**  ==========================
**
**  Version 2.0.7
**
**  Brought to you by
**  https://www.kycosoftware.com/
**
**  Copyright 2015 Cornelius Weidmann
**
**  Distributed under the GPL
**
*/

(function(e){var g={init:function(a){var c=e.extend({},{feedPosts:3,postsIncrement:3,maxPosts:20,profileImageSize:50,orderBy:"date",sort:"asc",lang:"en"},a);return this.each(function(){var a=e(this),g,h,b,w,x,v,p,t,l,u,m;c.lang="en"===c.lang?{langCode:"en",loading:"Loading...",showMore:"Show more",viewMore:"View more posts on Google+",shared:"Shared publicly - ",viewPost:"View post",errorEmpty:"Nothing to show. Empty feed. ",retryEmpty:"Refresh",errorGeneral:"Unable to retrieve feed contents. ",errorNotFound:"User not found... Enter a valid Google+ ID",retryGeneral:"Retry"}:{langCode:"de",loading:"Wird geladen...",showMore:"Mehr anzeigen",viewMore:"Weitere Beitr\u00e4ge ansehen bei Google+",shared:"\u00d6ffentlich geteilt - ",viewPost:"Beitrag ansehen",errorEmpty:"Nichts zu sehen. Keine Beitr\u00e4ge. ",retryEmpty:"Wiederholen",errorGeneral:"Es ist ein Fehler beim Abrufen der Beitr\u00e4ge aufgetreten. ",errorNotFound:"Benutzer nicht gefunden... Verwende einen g\u00fcltigen Google+ ID",retryGeneral:"Wiederholen"};g=e('<div id="feed_'+a.attr("class")+'" class="kyco_googleplusfeed '+c.lang.langCode+'"></div>');h=e('<div class="feed_loader">'+c.lang.loading+"</div>");b=e('<div class="feed_wrapper"></div>');w=e('<div class="feed_header"></div>');x=e('<h3 class="feed_screen_name"><a href="#" target="_blank"></a></h3>');v=e('<a href="#" class="feed_profile_image" target="_blank"></a>');p=e('<div class="feed_content"></div>');t=e('<span class="feed_show_more">'+c.lang.showMore+"</span>");l=e('<div class="error"></div>');u=e('<span class="retry"></span>');w.append(v,x);b.append(w,p,t);g.append(h,b);a.append(g);m=new function(a){var d=this;d.id=a;d.url="https://plus.google.com/"+d.id;d.init=function(){function e(c,b){var d=b||!1,k="",f,r,h,k=a[c].publishedDate.substr(0,19);f=k.split("T")[0];h=f.split("-")[0];r="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")["01 02 03 04 05 06 07 08 09 10 11 12".split(" ").indexOf(f.split("-")[1])];f=f.split("-")[2];k=k.split("T").pop();f=f+" "+r+" "+h;return d?f+" "+k:f}function d(f){return'<div class="feed_post post_'+(f+1)+'"><span title="'+e(f,!0)+'">'+c.lang.shared+e(f)+"</span><p>"+a[f].content+'</p><a href="'+a[f].url+'" target="_blank">'+c.lang.viewPost+"</a></div>"}var a=m.entries,n=a.length,k=c.feedPosts,y=c.postsIncrement,q=0,z=!1,g=0,r=k,f="",k=n<k?n:k;if(0<n){for(;g<k;g++)f+=d(g);x.children("a").attr("href",m.url).text(m.screenName);v.attr("href",m.url);v.append('<img src="'+m.image+'" width="'+c.profileImageSize+'" height="'+c.profileImageSize+'">');p.html(f);p.animate({scrollTop:0},1);b.fadeIn(300)}else b.children().remove(),l.text(c.lang.errorEmpty),u.text(c.lang.retryEmpty),l.append(u),b.append(l),b.fadeIn(300),b.find(".retry").click(function(){b.children().remove();b.append(h);h.show();m.getFeed()});t.click(function(){var b=function(){window.open(m.url)};if(q<=n){q+=z?y:k+y;for(q=q>n?n:q;r<q;r++)f+=d(r),r===n-1&&(t.unbind("click").addClass("link"),t.text(c.lang.viewMore).click(b));p.animate({scrollTop:p[0].scrollHeight},500);z=!0}p.html(f)})};d.getFeed=function(){e.ajax({type:"GET",url:"https://www.kycosoftware.com/api/googleplus-feed/"+d.id,dataType:"json",success:function(a){var g,m,n;try{"404"!==a&&!1!==a?(g=a.profile,m=a.activity,n=function(a){for(var b=[],e=a.length,d=0,g=0;d<e;d++)g<c.maxPosts&&""!==a[d].object.content&&(b.push({url:a[d].object.url,publishedDate:a[d].published,content:a[d].object.content,plusones:a[d].object.plusoners.totalItems}),g++);switch(c.orderBy){case "date":b.sort(function(a,b){return new Date(b.publishedDate)-new Date(a.publishedDate)});break;case "popularity":"asc"===c.sort?b.sort(function(a,b){return b.plusones-a.plusones}):b.sort(function(a,b){return a.plusones-b.plusones})}return b},d.screenName=g.displayName,d.entries=n(m.items),d.image=g.image.url.substr(0,g.image.url.indexOf("?"))+"?sz="+c.profileImageSize,e.get(d.image).fail(function(){d.image="https://www.kycosoftware.com/images/general/googleplus-404.png"}).always(function(){e('<img src="'+d.image+'">').load(function(){h.fadeOut(300,function(){h.remove();d.init()})})})):"404"===a?h.fadeOut(300,function(){l.text(c.lang.errorNotFound);b.html(l);b.fadeIn(300)}):h.fadeOut(300,function(){l.text(c.lang.errorGeneral);b.html(l);b.fadeIn(300)})}catch(k){h.fadeOut(300,function(){b.children().remove();l.text(c.lang.errorGeneral);u.text(c.lang.retryGeneral);l.append(u);b.append(l);b.fadeIn(300);b.find(".retry").click(function(){b.children().remove();b.append(h);h.show();d.getFeed()})})}}})};d.getFeed()}(c.id)})}};e.fn.kycoGooglePlusFeed2=function(a){var c=a;"string"===typeof a&&(c={id:a});return g[a]?g[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof c?g.init.apply(this,[c]):e.error("Method "+a+" does not exist on jQuery.kycoGooglePlusFeed2")}})(jQuery);
