/***************************************\

	jquery.kyco.googleplusfeed
	==========================

	Version 2.0.1

	Brought to you by
	http://www.kycosoftware.com/

	Copyright 2014 Cornelius Weidmann

	Distributed under the GPL

\***************************************/

(function(b){var g={init:function(f){var e=b.extend({},{feedPosts:3,postsIncrement:3,maxPosts:20,profileImageSize:50,lang:"en"},f);return this.each(function(){function f(){function b(c){var a;a=""+('<div class="feed_post post_'+(c+1)+'">')+('<span title="'+d(c,!0)+'">'+e.lang.shared+d(c)+"</span>");a+="<p>"+r[c].content+"</p>";a+='<a href="'+r[c].url+'" target="_blank">'+e.lang.viewPost+"</a>";return a+="</div>"}function d(c,e){e=e||!1;var a="",a=r[c].publishedDate.substr(0,19),b=a.split("T")[0], d=b.split("-")[0],l="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")["01 02 03 04 05 06 07 08 09 10 11 12".split(" ").indexOf(b.split("-")[1])],b=b.split("-")[2],a=a.split("T").pop(),b=b+" "+l+" "+d;return e?b+" "+a:b}var r=m.entries,n=r.length,a=e.feedPosts,g=e.postsIncrement,l=0,x=!1,v=0,s=a,p="",a=n<a?n:a;if(0<n){for(;v<a;v++)p+=b(v);y.children("a").attr("href",m.url).text(m.screenName);w.attr("href",m.url);w.append('<img src="'+m.image+'" width="'+e.profileImageSize+'" height="'+e.profileImageSize+ '">');q.html(p);q.animate({scrollTop:0},1);c.fadeIn(300)}else c.children().remove(),h.text(e.lang.errorEmpty),t.text(e.lang.retryEmpty),h.append(t),c.append(h),c.fadeIn(300),c.find(".retry").click(function(){c.children().remove();c.append(k);k.show();m.getFeed()});u.click(function(){if(l<=n){l+=x?g:a+g;for(l=l>n?n:l;s<l;s++)p+=b(s),s===n-1&&(u.unbind("click").addClass("link"),u.text(e.lang.viewMore).click(function(){window.open(m.url)}));q.animate({scrollTop:q[0].scrollHeight},500);x=!0}q.html(p)})} var a=b(this);e.lang="en"===e.lang?{langCode:"en",loading:"Loading...",showMore:"Show more",viewMore:"View more posts on Google+",shared:"Shared publicly - ",viewPost:"View post",errorEmpty:"Nothing to show. Empty feed. ",retryEmpty:"Refresh",errorGeneral:"Unable to retrieve feed contents. ",errorNotFound:"User not found... Enter a valid Google+ ID",retryGeneral:"Retry"}:{langCode:"de",loading:"Wird geladen...",showMore:"Mehr anzeigen",viewMore:"Weitere Beitr\u00e4ge ansehen bei Google+",shared:"\u00d6ffentlich geteilt - ", viewPost:"Beitrag ansehen",errorEmpty:"Nichts zu sehen. Keine Beitr\u00e4ge. ",retryEmpty:"Wiederholen",errorGeneral:"Es ist ein Fehler beim Abrufen der Beitr\u00e4ge aufgetreten. ",errorNotFound:"Benutzer nicht gefunden... Verwende einen g\u00fcltigen Google+ ID",retryGeneral:"Wiederholen"};var z=b('<div id="feed_'+a.attr("class")+'" class="kyco_googleplusfeed '+e.lang.langCode+'"></div>'),k=b('<div class="feed_loader">'+e.lang.loading+"</div>"),c=b('<div class="feed_wrapper"></div>'),g=b('<div class="feed_header"></div>'), y=b('<h3 class="feed_screen_name"><a href="#" target="_blank"></a></h3>'),w=b('<a href="#" class="feed_profile_image" target="_blank"></a>'),q=b('<div class="feed_content"></div>'),u=b('<span class="feed_sow_more">'+e.lang.showMore+"</span>"),h=b('<div class="error"></div>'),t=b('<span class="retry"></span>');g.append(w,y);c.append(g,q,u);z.append(k,c);a.append(z);var m=new function(a){var d=this;d.id=a;d.url="https://plus.google.com/"+d.id;d.init=function(){f()};d.getFeed=function(){b.ajax({type:"GET", url:"http://www.kycosoftware.com/api/googleplus-feed/"+d.id,dataType:"json",success:function(a){try{if("404"!=a&&!1!==a){var f=a.profile,g=a.activity;d.screenName=f.displayName;d.entries=function(a){for(var b=[],c=a.length,d=0,f=0;d<c;d++)f<e.maxPosts&&""!=a[d].object.content&&(b.push({url:a[d].object.url,publishedDate:a[d].published,content:a[d].object.content}),f++);return b}(g.items);d.image=f.image.url.substr(0,f.image.url.indexOf("?"))+"?sz="+e.profileImageSize;b.get(d.image).fail(function(){d.image= "http://www.kycosoftware.com/images/general/googleplus-404.png"}).always(function(){b('<img src="'+d.image+'">').load(function(){k.fadeOut(300,function(){k.remove();d.init()})})})}else"404"==a?k.fadeOut(300,function(){h.text(e.lang.errorNotFound);c.html(h);c.fadeIn(300)}):k.fadeOut(300,function(){h.text(e.lang.errorGeneral);c.html(h);c.fadeIn(300)})}catch(m){k.fadeOut(300,function(){c.children().remove();h.text(e.lang.errorGeneral);t.text(e.lang.retryGeneral);h.append(t);c.append(h);c.fadeIn(300); c.find(".retry").click(function(){c.children().remove();c.append(k);k.show();d.getFeed()})})}}})};d.getFeed()}(e.id)})}};b.fn.kycoGooglePlusFeed2=function(f){"forEach"in Array.prototype||(Array.prototype.forEach=function(b,f){for(var a=0,g=this.length;a<g;a++)a in this&&b.call(f,this[a],a,this)});"string"===typeof f&&(f={id:f});if(g[f])return g[f].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof f&&f)b.error("Method "+f+" does not exist on jQuery.kycoGooglePlusFeed2");else return g.init.apply(this, arguments)}})(jQuery);
